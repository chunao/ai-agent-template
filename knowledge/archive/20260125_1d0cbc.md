---
title: AI時代にGitHubを最強のToDo管理秘書にする(ProjectV2API編)
url: https://qiita.com/o_ob/items/8c1141897c4a68e171e9
captured_at: 2026-01-25
published_at: 2025-11-09
---

# AI時代にGitHubを最強のToDo管理秘書にする(ProjectV2API編)

## TL;DR & Key Conclusions

GitHub ActionsからProjectV2にアクセスする際、トークンの種類によってアクセス可能なプロジェクトタイプが異なる。ユーザーレベルのProjectV2にはClassic PATが必須であり、Fine-grained PATでは仕様上アクセスできない。組織レベルのProjectV2は両方のトークンタイプでアクセス可能だが、セキュリティ上Fine-grained PATが推奨される。

- **トークンタイプとプロジェクトタイプの互換性**: ユーザーレベルProjectV2はClassic PAT必須、組織レベルはFine-grained PAT/Classic PAT両方可
- **よくあるエラーの原因**: "Could not resolve to a ProjectV2" エラーはトークン権限不足が原因
- **Classic PAT使用時の必須スコープ**: `project`スコープが必須、`repo`スコープも推奨
- **Fine-grained PAT使用時の必須権限**: 組織権限で "Projects: read and write"、リポジトリ権限で "Metadata: read"
- **セキュリティ推奨**: 組織プロジェクトではFine-grained PATを優先（権限範囲が狭い）
- **デフォルトGITHUB_TOKENの制限**: ワークフローのデフォルトトークンではユーザーレベルProjectV2にアクセス不可
- **テスト方法**: workflow_dispatch入力を使った手動テストで、コード変更なしに検証可能
- **プロジェクト番号の永続性**: URLのプロジェクト番号は削除後も保持されるため、自動化前に正しいURLを確認すること

## Quickstart

### ユーザーレベルProjectV2へのアクセス設定（Classic PAT）

1. **Classic PATの生成**: GitHub Settings → Developer settings → Personal access tokens (classic) でトークンを作成
2. **必須スコープの有効化**: `project`（必須）、`repo`（推奨）にチェック
3. **シークレットへの保存**: リポジトリのSecretsに保存（例: `PAT_MYTODO_PROJECT_TOKEN_CLASSIC`）
4. **ワークフローでの使用**: `actions/github-script@v7`でトークンを指定してGraphQLクエリを実行

### 組織レベルProjectV2へのアクセス設定（Fine-grained PAT）

1. **Fine-grained tokenの作成**: GitHub Settings → Developer settings → Fine-grained personal access tokens
2. **組織権限の設定**: `Projects: read and write`
3. **リポジトリ権限の設定**: `Metadata: read`
4. **シークレットへの保存**: リポジトリのSecretsに保存
5. **ワークフローでの使用**: Classic PATと同様に使用可能

## Context & Claims (Claim-Evidence-Caveat)

- **Claim**: ユーザーレベルのProjectV2にはFine-grained PATではアクセスできない
    - **Evidence**: GitHub公式ドキュメントの制限事項として明記されている。Fine-grained PATでアクセスを試みると "Could not resolve to a ProjectV2" エラーが発生する
    - **Caveat**: この制限はGitHub仕様によるものであり、将来的に変更される可能性がある

- **Claim**: Classic PATには`project`スコープが必須
    - **Evidence**: `project`スコープなしでアクセスすると権限エラーが発生する。記事内のワークフロー例で実証済み
    - **Caveat**: `repo`スコープも推奨されるが、ProjectV2へのアクセスのみであれば`project`スコープのみで動作する

- **Claim**: workflow_dispatch入力を使うことで、コード変更なしにトークンタイプをテストできる
    - **Evidence**: YAML設定で`workflow_dispatch`に`token_type`入力を定義し、条件分岐でトークンを切り替える実装例が提供されている
    - **Caveat**: 手動トリガーのため、自動化された継続的テストには向かない

- **Claim**: デフォルトの`GITHUB_TOKEN`ではユーザーレベルProjectV2にアクセスできない
    - **Evidence**: ワークフローのデフォルトトークンで試行するとアクセスエラーが発生する
    - **Caveat**: 組織レベルのProjectV2であれば、適切な権限設定下で`GITHUB_TOKEN`でもアクセス可能な場合がある

## Code Snippets

### トークンタイプの条件分岐（YAML）

プロジェクトの所有者タイプに応じてトークンを切り替える設定：

```yaml
- name: Determine token type
  id: token
  run: |
    if [ "${{ env.PROJECT_OWNER_KIND }}" = "user" ]; then
      echo "token=${{ secrets.PAT_MYTODO_PROJECT_TOKEN_CLASSIC }}" >> $GITHUB_OUTPUT
    else
      echo "token=${{ secrets.PAT_MYTODO_PROJECT_TOKEN }}" >> $GITHUB_OUTPUT
    fi
```

### ProjectV2へのGraphQLクエリ（github-script）

ユーザーのProjectV2情報を取得するクエリ：

```yaml
- name: Query ProjectV2
  uses: actions/github-script@v7
  with:
    github-token: ${{ steps.token.outputs.token }}
    script: |
      const query = `query($login:String!, $number:Int!){
        user(login:$login) { projectV2(number:$number) { id title } }
      }`;
      const res = await github.graphql(query, {
        login: 'your-username',
        number: 4
      });
      console.log(res);
```

### workflow_dispatch手動テスト設定

トークンタイプを手動で選択してテストする設定：

```yaml
on:
  workflow_dispatch:
    inputs:
      token_type:
        description: 'Token type to test'
        required: true
        type: choice
        options:
          - fine-grained
          - classic
```

### 手動テスト実行コマンド

Fine-grained PATのテスト：
```bash
gh workflow run "Test ProjectV2 PAT Access" -f token_type=fine-grained
```

Classic PATのテスト：
```bash
gh workflow run "Test ProjectV2 PAT Access" -f token_type=classic
```

## Normalized Conditions

- **Use Cases**:
    - GitHub ActionsからユーザーレベルのProjectV2を自動更新したい場合
    - 組織レベルのProjectV2にセキュアにアクセスしたい場合
    - IssueやPRの作成時に自動的にProjectV2へアイテムを追加したい場合
    - AI秘書としてGitHub ProjectsをToDo管理に活用したい場合
    - workflow_dispatchを使ってトークン権限を検証したい場合

- **Anti-Cases**:
    - 手動でProjectV2を更新するだけで自動化が不要な場合
    - GitHub CLIやWeb UIで十分な単発操作
    - プロジェクト番号が頻繁に変わる環境（番号は永続的だが、誤った番号での自動化は危険）

- **Decision Triggers**:
    - "Could not resolve to a ProjectV2" エラーが発生した場合
    - ユーザーレベルのProjectV2に自動アクセスする必要が生じた場合
    - 組織レベルでFine-grained PATへの移行を検討する場合
    - GitHub ActionsでのProjectV2自動化を初めて実装する場合
    - セキュリティ要件により最小権限でのトークン利用が求められる場合
