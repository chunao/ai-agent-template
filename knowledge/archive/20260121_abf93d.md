---
title: Claude Codeとの会話を自動でObsidianに記録する仕組みを作った
url: https://zenn.dev/pepabo/articles/ffb79b5279f6ee
captured_at: 2026-01-21
published_at: 2026-01-10
---

# Claude Codeとの会話を自動でObsidianに記録する仕組みを作った

## TL;DR & Key Conclusions
Claude Codeとの会話セッションを自動的にObsidianのナレッジベースに記録するシステムの実装記事。セッションのJSONLファイルを監視し、整形してMarkdownに変換、Gitで自動コミットする仕組み。

- **目的**: Claude Codeとの会話が揮発的に失われることを防ぎ、学びを蓄積する
- **監視方式**: 5秒ごとにセッションファイルの変更を検知
- **ノイズ除去**: JQでシステムメッセージや内部コマンドをフィルタリング
- **追記モード**: 上書きではなく追記でクラッシュ時のデータ喪失を防止
- **日付単位整理**: タイムスタンプに基づき1日1ファイルで管理
- **常駐実行**: macOSのLaunchAgentでバックグラウンド動作
- **複数環境対応**: chezmoiでdotfiles管理し複数Macに展開可能

## Quickstart
1. **監視スクリプト作成**: `watch-and-save.sh`を作成し、Claude CodeのセッションディレクトリとObsidianの出力先を設定
2. **JQでフィルタリング設定**: システムメッセージを除外するフィルタを定義
3. **LaunchAgent設定**: plistファイルを作成し`~/Library/LaunchAgents/`に配置
4. **LaunchAgent読み込み**: `launchctl load`で常駐起動を有効化
5. **動作確認**: ログファイルで正常動作を確認

## Context & Claims (Claim-Evidence-Caveat)
- **Claim**: Claude Codeとの会話は貴重なナレッジだが揮発的に失われる
    - **Evidence**: セッション終了後、会話履歴へのアクセスが困難になる
    - **Caveat**: Claude Code自体にも履歴機能はあるが、検索性・活用性に課題がある

- **Claim**: 5秒間隔の監視で実用的なリアルタイム記録が可能
    - **Evidence**: 著者の運用実績に基づく
    - **Caveat**: 監視間隔は環境に応じて調整が必要

- **Claim**: JQによるフィルタリングでノイズを除去できる
    - **Evidence**: システムリマインダーや内部メッセージを除外した整形出力
    - **Caveat**: フィルタ条件はClaude Codeのメッセージ形式に依存

- **Claim**: 追記モードでデータ喪失を防止できる
    - **Evidence**: クラッシュ時に既存記録が保持される
    - **Caveat**: ファイルの肥大化には別途対策が必要

## Code Snippets
- **watch-and-save.sh**: セッションファイルを監視し、変更を検知してMarkdownに変換・追記するメインスクリプト
- **LaunchAgent plist**: macOSで監視スクリプトを常駐実行させるための設定ファイル
- **JQフィルタ**: システムメッセージを除外し、ユーザー/Claude会話のみを抽出するフィルタ定義

## Normalized Conditions
- **Use Cases**:
    - Claude Codeを日常的に使用し、会話内容を後から参照したい場合
    - Obsidianでナレッジ管理をしており、AI会話も統合したい場合
    - チームでClaude Codeの活用ノウハウを共有したい場合
- **Anti-Cases**:
    - Claude Codeを一時的・単発でしか使わない場合
    - Obsidian以外のノートツールを使用している場合（要改修）
    - Windows/Linux環境（LaunchAgent部分の書き換えが必要）
- **Prerequisites**:
    - macOS環境
    - Obsidianのセットアップ済み
    - JQのインストール
    - シェルスクリプトの基本知識
    - chezmoiの理解（複数環境対応する場合）
- **Decision Triggers**:
    - Claude Codeで週に複数回以上会話している
    - 過去の会話を検索したくなることがある
    - ナレッジ蓄積を自動化したい
