---
title: GitHub Issue 作成時にラベル付与と Projects V2 の日付更新を自動化してみた
url: https://note.com/cross8365/n/nb922f37b1ca7
captured_at: 2026-01-25
published_at: 2026-01-08
---

# GitHub Issue 作成時にラベル付与と Projects V2 の日付更新を自動化してみた

## TL;DR & Key Conclusions

GitHub ActionsとGraphQL APIを使用して、Issue作成時のラベル自動付与とProjects V2への日付フィールド自動更新を実現する方法を解説。手動作業を削減し、タスク管理の効率化を図る。

- **Fine-grained Tokenの制約**: Projects V2の操作にはFine-grained Tokenではなく、Classic Personal Access Tokenが必要（2025年5月時点）
- **Issue FormとGitHub Actionsの連携**: Issue Formのlabelsフィールドは固定値のみ対応。動的なラベル付与はGitHub Actionsで実現する必要がある
- **GraphQL APIの必要性**: Projects V2の操作にはREST APIではなくGraphQL APIを使用する
- **権限設定の重要性**: Workflow permissionsを"Read and write permissions"に設定しないとラベル付与が失敗する
- **IDの取得方法**: Project IDとField IDをGitHub CLIのGraphQLクエリで取得する必要がある
- **日付形式の厳密性**: 開始日・期限はYYYY-MM-DD形式で入力する必要があり、正規表現でバリデーションされる
- **トークンのスコープ**: Personal Access Tokenにはrepoとprojectの両方のスコープが必要
- **セキュリティ考慮**: トークンはRepository Secretsに保存し、有効期限を設定して定期更新する
- **GITHUB_TOKENの制約**: デフォルトのGITHUB_TOKENではProjects V2への書き込み権限が不足するため、Classic Tokenが必須
- **自動化のメリット**: カテゴリ選択→ラベル付与、日付入力→Projects反映が自動化され、手作業が削減される
- **トラブルシューティング**: エラー発生時はActionsタブでWorkflow実行ログを確認する
- **拡張性**: カテゴリやフィールドの追加・変更時はWorkflowとラベルの両方を更新する必要がある

## Quickstart

1. **Issue Templateの作成**: `.github/ISSUE_TEMPLATE/task.yml`にカテゴリ、優先度、開始日、期限などのフィールドを定義
2. **Personal Access Token（Classic）の作成**: GitHub Settings → Developer settings → Personal access tokens → Tokens (classic)でrepo・projectスコープのトークンを生成
3. **Secretsへの登録**: リポジトリのSettings → Secrets and variables → Actionsで`ISSUE_ADD_TO_PROJECT_TOKEN`として登録
4. **Project ID・Field IDの取得**: GitHub CLIで`gh auth refresh -s read:project,project`を実行後、GraphQLクエリでProject IDとStart date・Target dateのField IDを取得
5. **GitHub Actions Workflowの作成**: `.github/workflows/auto-label.yml`に2つのジョブ（add-label、update-project）を定義し、取得したIDを設定
6. **Workflow permissions変更**: リポジトリのSettings → Actions → GeneralでWorkflow permissionsを"Read and write permissions"に設定
7. **ラベルの作成**: Issues → Labelsでprivate、learning、otherなどのラベルを作成
8. **動作確認**: Issue作成時にラベルが自動付与され、Projects V2に追加・日付が反映されることを確認

## Context & Claims (Claim-Evidence-Caveat)

- **Claim**: Fine-grained TokenではProjects V2を操作できない
    - **Evidence**: 記事内で「Fine-grained Token は Projects V2 に対応していません（2025年5月時点）」と明記されており、Classic Tokenの使用を推奨
    - **Caveat**: 将来的にFine-grained Tokenが対応する可能性がある。最新の公式ドキュメントで確認が必要

- **Claim**: Issue Formのlabelsフィールドはドロップダウンからの動的付与に対応していない
    - **Evidence**: 記事内で「Issue Form の labels フィールドは固定ラベルのみ対応しています。ドロップダウンの選択値に応じた動的なラベル付与は、後述の GitHub Actions で実現します」と説明
    - **Caveat**: Issue Formの機能拡張により将来的に対応する可能性がある

- **Claim**: Projects V2の操作にはGraphQL APIが必須
    - **Evidence**: Workflow内でGraphQL mutationクエリを使用してIssueをProjectに追加し、日付フィールドを更新している
    - **Caveat**: REST APIでは一部の操作が可能な場合もあるが、Projects V2の高度な操作にはGraphQLが推奨される

- **Claim**: GITHUB_TOKENではProjects V2への書き込み権限が不足する
    - **Evidence**: トラブルシューティングセクションで「Resource not accessible by integration」エラーの原因として記載
    - **Caveat**: 将来的にGITHUB_TOKENの権限が拡張される可能性がある

- **Claim**: GitHub CLIでProject ID・Field IDを取得する必要がある
    - **Evidence**: Step 4で具体的なGraphQLクエリ例とコマンドが提示されている
    - **Caveat**: GitHub UI上でIDを確認する方法は記載されていないため、CLI操作が必須となる

- **Claim**: 日付はYYYY-MM-DD形式で厳密にバリデーションされる
    - **Evidence**: Workflow内で正規表現`^[0-9]{4}-[0-9]{2}-[0-9]{2}$`を使用してバリデーションを実施
    - **Caveat**: Issue Templateのplaceholderには例が示されているが、入力バリデーションは実装されていないため、ユーザーが誤った形式で入力した場合は更新がスキップされる

- **Claim**: Workflow permissionsの設定がラベル付与の成否を左右する
    - **Evidence**: Step 6で「Read and write permissions」への変更が必須と記載。トラブルシューティングにも確認項目として掲載
    - **Caveat**: リポジトリ作成時のデフォルト設定に依存するため、既存リポジトリでは確認が必要

- **Claim**: カテゴリの絵文字を含む文字列がbodyに含まれているかでラベルを判定する
    - **Evidence**: add-labelジョブのスクリプトで`body.includes(category)`を使用してマッチング
    - **Caveat**: Issue本文に意図せず同じ絵文字が含まれている場合、誤ったラベルが付与される可能性がある

## Code Snippets

- **Issue Template（task.yml）**: カテゴリ（Private/Learning/Other）、優先度（高/中/低）、開始日、期限、概要などのフィールドを定義。YAML形式でdropdownやinput、textareaタイプを使用
- **GitHub Actions Workflow（auto-label.yml）**: 2つのジョブで構成。add-labelジョブでactions/github-script@v7を使用してカテゴリからラベルを動的付与。update-projectジョブでGitHub CLIとGraphQL mutationを使用してProjectへの追加と日付フィールド更新を実行
- **GraphQL Query（Project ID取得）**: user.projectsV2クエリで自分のプロジェクト一覧とIDを取得
- **GraphQL Query（Field ID取得）**: node.fields クエリで特定ProjectのフィールドID一覧を取得
- **GraphQL Mutation（Issue追加）**: addProjectV2ItemByIdでIssueをProjectに追加し、Item IDを取得
- **GraphQL Mutation（日付更新）**: updateProjectV2ItemFieldValueで日付フィールド（Start date/Target date）を更新
- **Bash正規表現バリデーション**: `[[ "$START_DATE" =~ ^[0-9]{4}-[0-9]{2}-[0-9]{2}$ ]]`でYYYY-MM-DD形式を検証
- **GitHub CLI認証スコープ更新**: `gh auth refresh -s read:project,project`でプロジェクト操作権限を追加

## Normalized Conditions

- **Use Cases**:
    - GitHub Issueでタスク管理を行っており、Issue作成時の手作業を削減したい場合
    - Projects V2のカンバンやロードマップに自動反映させたい場合
    - カテゴリ選択に応じて自動的にラベルを付与したい場合
    - Issue本文に記載した日付情報をProjects V2の日付フィールドに自動同期したい場合
    - フリーランスや個人開発でGitHubベースのタスク管理を実現したい場合
    - プライベートタスクと業務タスクを統合管理したい場合
    - GitHub ActionsとGraphQL APIの学習・実践をしたい場合

- **Anti-Cases**:
    - Projects V2を使用していない場合
    - Issue作成頻度が極めて低く、自動化のメリットが少ない場合
    - Classic Personal Access Tokenの発行・管理ができない環境（組織ポリシーで制限されている場合など）
    - GitHub CLIのインストールや使用ができない環境
    - カテゴリや日付フィールドのカスタマイズが不要な単純なタスク管理

- **Decision Triggers**:
    - Issue作成時の手作業（ラベル選択、Projects追加、日付入力）が煩わしいと感じた時
    - タスク管理をGitHubに統一することを決定した時
    - Projects V2のカスタムフィールド（日付、ステータスなど）を活用したい時
    - 複数のカテゴリやラベルを体系的に管理する必要が生じた時
    - GitHub Actionsによるワークフロー自動化の導入を検討している時
