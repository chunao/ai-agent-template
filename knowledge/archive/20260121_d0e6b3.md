---
title: プロンプトの改善効果を可視化するClaude Codeプラグインを作った
url: https://zenn.dev/shinpr_p/articles/d0e6b387558e97
captured_at: 2026-01-21
published_at: 2026-01-21
---

# プロンプトの改善効果を可視化するClaude Codeプラグインを作った

## TL;DR & Key Conclusions
Claude Code向けのプラグイン「Rashomon」は、プロンプトの書き方による影響を可視化し、最適化版との比較結果を返すツールです。Git Worktreeを活用した完全隔離環境で並列実行することで、プロンプトの違いだけが結果に与える影響を明確に示します。

- **プロンプト最適化の可視化**: オリジナルと最適化されたプロンプトを並列実行し、結果を比較することで改善効果を実感できる
- **8つの問題パターン検出**: ネガティブ指示、曖昧な指示、出力形式の欠落など、汎用的なアンチパターンを自動検出
- **実行環境の完全隔離**: Git Worktreeを使用し、両方のプロンプトが互いに干渉しない環境を構築
- **「追加して」の罠**: 曖昧な指示はLLMに不要な作業をさせる原因となる（例: 既に十分なエラーハンドリングがあっても追加してしまう）
- **「変更しない」という選択肢**: 判断基準を与えることで、LLMが現状を分析し不要な変更をスキップできるようになる
- **プロンプトエンジニアリングの学習ツール**: 具体例を通じて、どのような書き方が結果に影響するかを直感的に理解できる
- **プロジェクト固有の知見蓄積**: 比較結果へのフィードバックを踏まえ、ナレッジベースとして蓄積し次回以降の最適化に活用可能

## Quickstart
1. **Claude Codeを起動**: ターミナルで `claude` コマンドを実行
2. **マーケットプレイスを追加**: `/plugin marketplace add shinpr/rashomon`
3. **プラグインをインストール**: `/plugin install rashomon@rashomon`
4. **セッションを再起動**: Claude Codeを再起動
5. **実行**: `/rashomon [オリジナルのプロンプトをコマンドに渡す]`

## Context & Claims (Claim-Evidence-Caveat)
- **Claim**: プロンプトの書き方が結果にどう作用するのかを理解することは難しく、修正効果が分かりづらい
    - **Evidence**: 「曖昧な指示は避けよう」といったベストプラクティスは存在するが、実際に修正してもその影響が可視化されない
    - **Caveat**: ツール開発者など試行錯誤を繰り返す人は体験的に理解できるが、一般ユーザーには分かりにくい

- **Claim**: Rashomonは5ステップでプロンプトの最適化効果を可視化する
    - **Evidence**: (1)プロンプト分析→問題パターン検出、(2)最適化版生成、(3)Git Worktreeで並列実装、(4)結果比較レポート、(5)フィードバック蓄積
    - **Caveat**: Git Worktreeを使用するため、Gitリポジトリ内での実行が前提となる

- **Claim**: 「追加して」という指示はLLMに無駄な作業を強制する
    - **Evidence**: 「geminiServiceにエラーハンドリングを追加して」という指示では、既に十分なエラーハンドリングがあってもLLMは何かを追加しようとする
    - **Caveat**: 目的ではなく手段（追加すること）が目標になってしまうため、要否を問わず追加が行われる

- **Claim**: 「変更しない」という選択肢を与えることで、LLMの過剰な変更を防げる
    - **Evidence**: 最適化版プロンプトでは「現在のエラーハンドリングが十分な場合は、その旨を報告し不要な変更は行わない」と明記することで、無駄な実装作業がスキップされた
    - **Caveat**: BP-008（不確実性を許容する指示）の応用であり、「判断に自信がないなら無理に行動しなくていい」という余地を与える必要がある

- **Claim**: 8つの問題パターンを自動検出し最適化できる
    - **Evidence**: BP-001（ネガティブ指示）、BP-002（曖昧な指示）、BP-003（出力形式の欠落）、BP-004（非構造化プロンプト）、BP-005（コンテキスト欠落）、BP-006（複雑なタスクの分割不足）、BP-007（バイアスのある例示）、BP-008（不確実性許容の欠落）を検出
    - **Caveat**: これらは2024-2025年のプロンプトエンジニアリング研究から汎用的に有益なものをピックアップしたもの

## Code Snippets
- **プラグインインストールコマンド**: Claude Code内でマーケットプレイスからプラグインを追加・インストールし、セッションを再起動する
- **Rashomon実行コマンド**: `/rashomon [オリジナルのプロンプト]` で最適化版との比較実行を開始できる

## Normalized Conditions
- **Use Cases**:
    - プロンプトの書き方による影響を具体的に理解したい場合
    - AIの想定外の挙動を制御したい場合
    - プロンプトエンジニアリング力を向上させたい場合
    - 「こう書くといい」というアドバイスを自分のケースに当てはめる方法を知りたい場合
    - チームでプロンプトのベストプラクティスを共有したい場合
- **Anti-Cases**:
    - プロンプトの最適化に関心がない場合
    - Gitリポジトリを使用していないプロジェクト
    - Claude Codeを使用していない環境
- **Prerequisites**:
    - Claude Codeがインストールされていること
    - Gitリポジトリ内で作業していること（Git Worktreeを使用するため）
    - 基本的なプロンプトエンジニアリングの知識
- **Decision Triggers**:
    - プロンプトの改善効果を実感できず、試行錯誤に時間がかかっている
    - LLMが意図しない挙動をする頻度が高い
    - プロンプトのベストプラクティスを学びたい
    - 既存のプロンプトをレビューし最適化したい
- **Failure Modes / Risks**:
    - Git Worktreeの操作に慣れていない場合、環境構築でつまずく可能性
    - 検出される問題パターンが自分のユースケースに適合しない場合がある
    - 最適化版プロンプトが必ずしも期待通りの結果を生むとは限らない
- **Operational Cost**:
    - 初回のプラグインインストールとセットアップ時間
    - 並列実行のため、通常の2倍の実行時間が必要
    - プロジェクト固有の知見を蓄積する場合、フィードバック作業が必要
