---
title: コンテキスト消費を抑える！Agent Skillsで実現するMarkdownファイルの段階的参照
url: https://zenn.dev/masato13/articles/7245e5d9aea0fd
captured_at: 2026-01-21
published_at: 2025-01-21
---

# コンテキスト消費を抑える！Agent Skillsで実現するMarkdownファイルの段階的参照

## TL;DR & Key Conclusions
Agent Skillsを活用して、Markdownファイルを段階的に参照することでコンテキスト消費を抑える手法を紹介。treemdツールとAgent Skillsを組み合わせることで、ローカルLLM・SLMでも効率的にドキュメント参照が可能になる。

- **段階的情報開示の重要性**: Agent Skillsは必要に応じて段階的に情報を読み込むため、特にコンテキストウィンドウが狭いローカルLLM(SLM)での利用に有効
- **treemdツールの活用**: Terminal上でMarkdownプレビューや見出しツリー表示、特定セクション抽出ができるツール
- **markdown-reader-skillの実装**: treemdのCLI機能を利用し、見出しツリー表示→必要なセクション抽出という2段階で効率的にMarkdown参照を実現
- **Python互換スクリプト同梱**: treemdのインストールが不要な軽量Python CLIを提供し、導入障壁を低減
- **幅広いユースケース**: ローカルLLM利用、RAG的な辞書参照、複数設計書の比較など多様な場面で活用可能
- **従来手法との差別化**: Vector DBやMCPサーバーといった大掛かりな仕組みなしに、コマンド一つでインデックス化されたMarkdown参照を実現

## Quickstart
1. **treemdのインストール**: `cargo install treemd` でインストール（またはReleaseページからバイナリをダウンロード）。Agent Skill利用のみならインストール不要
2. **markdown-reader-skillの取得**: GitHubリポジトリ（https://github.com/Tomatio13/markdown-reader-skill）からクローン
3. **見出しツリーの確認**: `md-index.py --tree path/to/doc.md` で対象Markdownの構造を把握
4. **セクションの抽出**: `md-index.py --section "見出し名" path/to/doc.md` で必要な部分のみ取得
5. **Agent Skillとして利用**: CodexやClaudeに「markdown-reader-skillを使ってREADME.mdの概要を教えてください」のようなプロンプトを与える

## Context & Claims (Claim-Evidence-Caveat)
- **Claim**: Agent Skillsの段階的情報開示により、コンテキスト消費を大幅に削減できる
    - **Evidence**: Claudeは仮想マシン上で動作し、ファイルシステムアクセスを備えているため、事前に全コンテキストを読み込むのではなく必要に応じて段階的に情報を取得できる
    - **Caveat**: ローカルLLM(SLM)のコンテキストウィンドウは狭いため、段階的開示がより重要になる

- **Claim**: treemdはTerminal上で完結するMarkdownビューア・CLIツールである
    - **Evidence**: TUIモードでMarkdownプレビューが可能、CLIモードで見出しツリー表示（`--tree`）とセクション抽出（`-s/--section`）をサポート
    - **Caveat**: RUSTで開発されており、cargoでのインストールが必要（ただしバイナリ配布もあり）。IDEやブラウザがない環境（VPN経由のTerminalなど）での利用に便利

- **Claim**: markdown-reader-skillはtreemdのCLI機能を活用したシンプルなAgent Skillである
    - **Evidence**: SKILL.mdには「見出しツリー表示→見出し選択→セクション抽出」という3ステップのみ記載。Python互換スクリプト（md-index.py）を同梱
    - **Caveat**: treemd以外の同様ツールは見出しツリー表示をサポートしていてもセクション抽出に対応していないものが多い

- **Claim**: RAGやVector DBなしでも、Markdownファイルをインデックス化して参照できる
    - **Evidence**: treemdのCLIモードを使えば、見出しをインデックスとして扱い、特定セクションのみを取得可能。MCPサーバーやVector DBといった大掛かりな仕組みが不要
    - **Caveat**: RAGのようなチャンキングと比較すると、Markdownの見出し構造に依存するため、構造化されていない文書には適用できない

## Code Snippets
- **見出しツリー表示**: `treemd --tree README.md` でMarkdownの見出し構造をツリー形式で表示
- **セクション抽出**: `treemd -s "見出し名" README.md` で特定の見出しとその本文を抽出
- **md-index.py（Python互換スクリプト）**: treemdの最低限機能を実装したPythonスクリプト。`--tree`と`-s/--section`オプションに対応し、完全一致を優先、部分一致にもフォールバック

## Normalized Conditions
- **Use Cases**:
    - ローカルLLM(SLM)でコンテキストウィンドウが狭い環境でのMarkdown参照
    - Terminal経由（VPN接続など）でIDEやブラウザが使えない状況でのドキュメント閲覧
    - 大規模なMarkdownドキュメントから必要な部分のみをAIに渡したい場合
    - RAGやVector DBを導入せずに軽量にMarkdownを辞書的に参照したい場合
    - 複数の設計書で同一章構成を持つドキュメントを比較・整合性確認する場合
- **Anti-Cases**:
    - Markdownの見出し構造が整っていない非構造化文書
    - コンテキストウィンドウが十分に広いフルスペックLLMのみを使用する場合
    - リアルタイムなセマンティック検索が必要な場合（RAGの方が適切）
- **Prerequisites**:
    - Agent Skillsの基本概念を理解していること
    - Terminalの基本操作ができること
    - Markdownの見出し構造（`#`, `##`, `###`など）を理解していること
    - （オプション）cargoコマンド、またはバイナリ配置の知識（treemd直接利用の場合）
- **Decision Triggers**:
    - ローカルLLM・SLMを使用していて、コンテキスト制限に頻繁に直面している
    - Terminal環境でMarkdownドキュメントを頻繁に参照する必要がある
    - Vector DBやMCPサーバーを導入するほどではないが、効率的なドキュメント参照が必要
    - 複数の構造化されたMarkdownドキュメントを比較・参照する業務がある
- **Failure Modes / Risks**:
    - 見出し名が曖昧または重複している場合、意図したセクションが取得できない可能性
    - Markdownの構造が複雑すぎると、ツリー表示が見づらくなる
    - セクション抽出は見出し構造に依存するため、見出し以外の情報（コードブロック、リストなど）のみをピンポイントで取得するのは困難
- **Operational Cost**:
    - treemdのインストールとセットアップ（cargoまたはバイナリ配置）
    - Agent Skillの設定とSKILL.mdの記述
    - md-index.pyスクリプトの配置と動作確認
    - Markdownドキュメントの見出し構造を事前に整理・標準化する労力
