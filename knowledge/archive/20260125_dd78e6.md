---
title: 【86万行・29,000コミット】AIが『本気で』コードを書いたらこうなった —— Cursorの大規模実験から学ぶ10の知見
url: https://qiita.com/hisaho/items/5bd0096ca33d5ea41acb
captured_at: 2026-01-25
published_at: 2026-01-23
---

# 【86万行・29,000コミット】AIが『本気で』コードを書いたらこうなった —— Cursorの大規模実験から学ぶ10の知見

## TL;DR & Key Conclusions
Cursorの並列AIエージェント研究プロジェクト「FastRender」（Rust製、86万行、29,858コミット）から得られた、AIコーディングを効果的に管理するための10の実践的知見。AIは一貫したドキュメント生成・エラーハンドリング・テスト生成が得意だが、明確なルール定義（AGENTS.md）、ワークストリーム分離、証拠ベースの開発、厳格なリソース制限が成功の鍵。

- **ドキュメントの一貫性**: AIは疲れないため、29,819箇所に統一されたドキュメントコメントを生成可能
- **テストとコード同時生成**: 1モジュール平均14テストを実装と同時に生成する傾向
- **エラーハンドリング統一**: 10,164箇所でResult型を使用し、プロジェクト全体で一貫したエラー処理
- **成果物への明確フォーカス**: 最終成果物を90%の目標とし、間接的改善は10%に抑える（90/10ルール）
- **ワークストリーム分離**: 並列AIエージェント向けに作業領域を明確に分離（FastRenderでは9つに分割）
- **Non-negotiables（破ってはいけないルール）**: 特定ケース向けハック禁止、仕様違反のショートカット禁止、パイプライン順序遵守、本番コードでのpanic禁止、実行は必ず制限付き
- **データ駆動開発**: Inject（計測埋め込み）→ Trace（追跡）→ Collect（収集）→ Understand（理解）→ Systematize（体系化）の5ステップ
- **優先度トリアージ**: P0（即座）からP5まで段階的に対応、クラッシュ/データ損失は最優先
- **シングルステップループ**: 実行→比較→差異特定→修正→検証を徹底、複数変更のバッチ処理は禁止
- **証拠の要件**: 自動テスト＋回帰テストが最良、AIの「改善した」報告のみは不可
- **リソース制限**: timeout -k（SIGKILLフォールバック付き）でタイムアウト厳格適用、メモリ・ディスク・スコープも制限
- **AGENTS.mdの重要性**: ワークストリーム定義、Non-negotiables、カウント対象の変更、リソース制限、テスト組織、哲学と文化を明文化することが必須

## Quickstart
このプラクティスを自分のAIコーディングプロジェクトに適用する手順：

1. **AGENTS.md作成**: プロジェクトルートにAGENTS.mdを作成し、ワークストリーム定義、Non-negotiables、カウント対象/非対象の変更、リソース制限、テスト組織、哲学と文化を明文化する
2. **ワークストリーム分離**: 並列作業する場合、作業領域を明確に分割し、それぞれに責任範囲を定義する
3. **リソース制限設定**: タイムアウト（timeout -k 10 600）、メモリ制限、ディスク制限、スコープ制限を設定する
4. **データ駆動開発導入**: 計測埋め込み→追跡→収集→理解→体系化のサイクルを確立する
5. **証拠ベース開発**: 修正より先に回帰テストを追加し、自動テスト＋回帰テストで証拠を残す
6. **シングルステップループ**: 実行→比較→差異特定→修正→検証を1つずつ行い、複数変更をまとめない
7. **優先度トリアージ**: P0（即座）からP5まで段階的に対応する仕組みを作る

## Context & Claims (Claim-Evidence-Caveat)

- **Claim**: AIコーディングは一貫したドキュメント生成が得意
    - **Evidence**: FastRenderプロジェクトで29,819箇所のドキュメントコメントが生成された
    - **Caveat**: 人間は疲れるため一貫性が維持しづらいが、AIは疲れないため一貫したスタイルを維持可能

- **Claim**: AIはテストとコード実装を同時に生成する傾向がある
    - **Evidence**: 1モジュール平均14テスト、合計18,496個のテスト関数が生成された
    - **Caveat**: テストの質は保証されないため、テストアーキテクチャ原則（ユニットテストはsrc/、統合テストはtests/）を明文化する必要がある

- **Claim**: エラーハンドリングの統一性が高い
    - **Evidence**: 10,164箇所でResult型を使用、プロジェクト全体で統一されたエラー型
    - **Caveat**: Non-negotiablesで「本番コードでのpanic禁止」を明記する必要がある

- **Claim**: 成果物への明確フォーカス（90/10ルール）が重要
    - **Evidence**: 最終成果物を90%の目標とし、間接的改善は10%に抑える
    - **Caveat**: カウント対象（新機能・バグ修正・安定性改善・UX改善）と非対象（ツール/インフラのみ、パフォーマンス最適化のみ、ドキュメント作成のみ）を明確に定義する必要がある

- **Claim**: ワークストリーム分離が並列AIエージェント開発の成功の鍵
    - **Evidence**: FastRenderでは9つのワークストリームに分割して並列開発
    - **Caveat**: 作業領域を明確に分離しないと、AIエージェント間でコンフリクトが発生する

- **Claim**: Non-negotiables（破ってはいけないルール）の明文化が必須
    - **Evidence**: 特定ケース向けハック禁止、仕様違反のショートカット禁止、パイプライン順序遵守、本番コードでのpanic禁止、実行は必ず制限付き
    - **Caveat**: これらのルールを破ると、プロジェクトの品質が急速に悪化する

- **Claim**: データ駆動開発メソッドが効果的
    - **Evidence**: Inject（計測埋め込み）→ Trace（追跡）→ Collect（収集）→ Understand（理解）→ Systematize（体系化）の5ステップ
    - **Caveat**: 計測埋め込みがないと、問題の根本原因を特定できない

- **Claim**: 優先度トリアージ（P0〜P5）が重要
    - **Evidence**: P0（クラッシュ/データ損失）は即座に対応、P1（機能停止）は24時間以内、P2〜P5は段階的に対応
    - **Caveat**: 優先度を明確にしないと、重要でない作業に時間を取られる

- **Claim**: シングルステップループ（実行→比較→差異特定→修正→検証）が成功パターン
    - **Evidence**: 複数変更をまとめて行うこと（バッチ修正）は失敗パターン
    - **Caveat**: 1つずつ修正・即検証しないと、どの変更が問題を引き起こしたか特定できない

- **Claim**: 証拠ベースの開発が必須
    - **Evidence**: 最良は自動テスト＋回帰テスト、許容はベースライン差分比較、最低限は手動確認記録、不可はAIの「改善した」報告のみ
    - **Caveat**: 修正より先に回帰テストを追加することで、再発を防ぐ

- **Claim**: リソース制限の厳格適用が必要
    - **Evidence**: timeout -k（SIGKILLフォールバック付き）、メモリ制限、ディスク制限、スコープ制限を設定
    - **Caveat**: タイムアウトはSIGKILLフォールバック（-k）が必須。SIGTERMを無視するコードが存在する可能性があるため

- **Claim**: AGENTS.mdの明文化がプロジェクト成功の鍵
    - **Evidence**: ワークストリーム定義、Non-negotiables、カウント対象の変更、リソース制限、テスト組織、哲学と文化を明文化
    - **Caveat**: これらが明文化されていないと、AIエージェントが一貫性のない動作をする

## Code Snippets

- **タイムアウト設定（SIGKILLフォールバック付き）**: 実行時間制限を設定し、SIGTERMを無視するコードにも対応
```bash
# 正しい：timeout -k でSIGKILLフォールバック設定
timeout -k 10 600 bash scripts/cargo_agent.sh build --release
timeout -k 10 600 bash scripts/cargo_agent.sh test --quiet --lib

# 推奨値
# 通常のビルド/テスト：timeout -k 10 600（10分）
# 単一集中テスト：timeout -k 10 120（2分）
# 完全ハーネス：timeout -k 10 900（15分）
```

## Normalized Conditions

- **Use Cases**:
    - AIコーディングツール（Cursor等）を使用する大規模プロジェクト
    - 複数のAIエージェントを並列で動作させる開発環境
    - Rust等の厳格な型システムを持つ言語でのAI開発
    - 一貫したドキュメント生成・エラーハンドリング・テスト生成が求められるプロジェクト
    - AGENTS.mdで明確なルール定義が可能な環境

- **Anti-Cases**:
    - 小規模プロトタイピング（ルール定義のオーバーヘッドが大きい）
    - 単一AIエージェントのみでの開発（ワークストリーム分離が不要）
    - 短期的な実験プロジェクト（証拠ベース開発の投資対効果が低い）
    - ルール定義や明文化が困難な環境

- **Decision Triggers**:
    - プロジェクトのコード行数が10万行を超える、またはその見込みがある
    - 複数のAIエージェントを並列で動作させる必要がある
    - プロジェクトの品質管理・一貫性維持が重要である
    - AIの「改善した」報告のみでは品質保証が不十分と感じる
    - タイムアウトやリソース制限なしでAIが暴走するリスクがある
    - テスト戦略やエラーハンドリングの一貫性が欠けている
