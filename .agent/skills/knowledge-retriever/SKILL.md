---
name: knowledge-retrieval
description: ユーザーが「方法」についてのガイダンスやベストプラクティスを求めている場合、または過去の知識やアーカイブされた例（`knowledge/index.json`から）が有益である可能性のある複雑なタスクに直面している場合に、このスキルを使用してください。このスキルにより、過去にアーカイブされた記事を発見し活用することができます。
---

# Knowledge Retrieval (ナレッジ検索)

## 概要

このスキルは、ローカルにアーカイブされた技術記事を「参考情報」として活用するためのものです。別のAIエージェント（Claude CLI）にナレッジ検索を委譲することで、メインエージェントのコンテキストウィンドウを節約します。

### 基本方針

- **メインエージェントの知識を第一に**: タスクの実行は、あなた自身の知識とベストプラクティスを基盤として進めてください
- **ローカルナレッジは参考情報**: アーカイブされた記事は「こういう手段も世の中にはあるんだな」という参考程度の位置づけです
- **選択的な適用**: 「なるほど、これは使えそうな情報だ」と判断したものについてのみ、その知見をあなたの判断に組み込んでください
- **絶対視しない**: ローカルナレッジに記載されている方法が唯一の解決策ではありません。あなた自身の判断を優先してください

## ワークフロー

### ステップ 1: Claude CLIによるナレッジ検索（コンテキスト節約）

**重要**: メインエージェントは `index.json` を読み込みません。代わりに、別のAIエージェント（Claude CLI）にナレッジ検索タスクを委譲します。これにより、メインエージェントのコンテキストウィンドウを節約できます。

以下のコマンドを実行して、Claude CLIに検索を依頼します：

```powershell
claude --print "以下のナレッジ検索タスクを実行してください：

【タスク概要】
knowledge/index.json を分析し、現在のユーザーリクエストに関連する記事を最大5件選択してください。

【分析手順】
1. d:/projects/P010/knowledge/index.json を読み込む
2. 各記事のメタデータを以下の観点で分析：
   - tags: 現在のトピックとの一致度
   - use_cases: 現在の状況との適合性
   - decision_triggers: 類似したトリガーの存在
   - anti_cases: 避けるべき条件の確認
3. 関連度の高い記事を最大5件選択（複数の視点を含める）
4. 選択した記事のIDのみを以下の形式で出力

【出力フォーマット】
以下の形式で、選択した記事のIDのみを出力してください：

SELECTED_ARTICLE_IDS:
- 20260120_a1cce2
- 20260121_63d325
- 20260121_555780

【現在のユーザーリクエスト】
[ここにユーザーの質問やタスク内容を記述]
"
```

**注意事項**:
- `[ここにユーザーの質問やタスク内容を記述]` の部分を、実際のユーザーリクエストに置き換えてください
- 引用符内に二重引用符が含まれる場合は、適切にエスケープ（`\"`）してください
- `--print` フラグは必須です（削除すると対話モードになりハングします）

**実行監視**:
- `command_status` で5秒おきに監視し、完了まで待機してください（通常10〜30秒）
- 120秒以上経過しても完了しない場合は、ユーザーに状況を報告してください

### ステップ 2: IDリストの抽出

Claude CLIの出力から、`SELECTED_ARTICLE_IDS:` セクション以降の行を抽出し、各行から記事ID（`YYYYMMDD_XXXXXX` 形式）を取得します。

**期待される出力**:
```
SELECTED_ARTICLE_IDS:
- 20260120_a1cce2
- 20260121_63d325
- 20260121_555780
```

正規表現 `\d{8}_[a-f0-9]{6}` でIDを抽出できます。

### ステップ 3: コンテンツの取得

抽出したIDの記事のみを読み込みます。これにより、必要最小限のコンテキスト消費で済みます。

```python
view_file(AbsolutePath="d:/projects/P010/knowledge/archive/20260120_a1cce2.md")
view_file(AbsolutePath="d:/projects/P010/knowledge/archive/20260121_63d325.md")
view_file(AbsolutePath="d:/projects/P010/knowledge/archive/20260121_555780.md")
```

### ステップ 4: ナレッジの参考活用（選択的適用）

取得した記事を読み、以下の観点で評価してください：

**評価のポイント**:
- この情報は現在のタスクに本当に有用か？
- あなた自身の知識と矛盾していないか？比較してどちらが適切か？
- 記事の情報は最新か？（`published_at` を確認）
- この手法は現在の状況に適用可能か？

**有用と判断した場合の活用方法**:
- 解決策や計画の「一つの選択肢」として考慮する
- ベストプラクティスを参考にしつつ、状況に応じてカスタマイズする
- 既知の落とし穴（失敗モード）があれば、回避策を検討する
- 運用コストや前提条件を理解した上で、採用するか判断する

**注意**: アーカイブされた記事は「こういうアプローチもある」という参考情報です。あなた自身の知識とベストプラクティスを第一に考え、有用と判断したもののみを組み込んでください。

## 重要な注意点

-   **あなたの知識を第一に**: このスキルは補助的なツールです。あなた自身の知識、ベストプラクティス、判断力を最優先してください。
-   **コンテキスト分離の利点**: このワークフローでは、メインエージェントは `index.json`（約82KB）を一切読み込みません。検索AIが別コンテキストで処理するため、メインエージェントのコンテキストウィンドウを100%節約できます。
-   **AI検索の信頼性**: Claude CLIは82KBのindex.json全体を総合的に分析できるため、Pythonスクリプトでは実現できない高度なセマンティック検索が可能です。タグの表記ゆれ（例: "MCP" と "Model Context Protocol"）も適切に認識します。
-   **選択的な参照**: Claude CLIが選択した記事IDのみを読み込みます。通常3〜5件の記事に絞り込まれるため、必要最小限のコンテキスト消費で済みます。これらの記事はあくまで「こういう手段もあるんだな」という参考情報です。
-   **鮮度の確認**: `published_at` の日付を確認してください。古い記事には時代遅れの情報が含まれている可能性があります。あなた自身の判断を使用してください。
-   **一つの参考例**: アーカイブされたナレッジは、物事を行うための*一つの*方法（例）を表しており、必ずしも*唯一の*または*絶対的に最良の*方法ではありません。あなた自身の知識と比較し、有用と判断したもののみを採用してください。

## 使用例

### 例1: Claude Codeの並列実行について知りたい場合

**ユーザーリクエスト**: "Claude Codeで複数のタスクを並列実行する方法を教えて"

**実行コマンド**:
```powershell
claude --print "以下のナレッジ検索タスクを実行してください：

【タスク概要】
knowledge/index.json を分析し、現在のユーザーリクエストに関連する記事を最大5件選択してください。

【分析手順】
1. d:/projects/P010/knowledge/index.json を読み込む
2. 各記事のメタデータを以下の観点で分析：
   - tags: 現在のトピックとの一致度
   - use_cases: 現在の状況との適合性
   - decision_triggers: 類似したトリガーの存在
   - anti_cases: 避けるべき条件の確認
3. 関連度の高い記事を最大5件選択（複数の視点を含める）
4. 選択した記事のIDのみを以下の形式で出力

【出力フォーマット】
以下の形式で、選択した記事のIDのみを出力してください：

SELECTED_ARTICLE_IDS:
- 20260120_a1cce2
- 20260121_63d325
- 20260121_555780

【現在のユーザーリクエスト】
Claude Codeで複数のタスクを並列実行する方法を教えて
"
```

**Claude CLIの出力例**:
```
SELECTED_ARTICLE_IDS:
- 20260120_a1cce2    # Claude Code のサブエージェントで GitHub Issue を並列処理する方法
- 20260121_f9e324    # Claude Codeの並列実行を効率化する管理アプリを作った
- 20260121_1153aa    # Google AI Proで使い倒すAntigravity開発ノウハウ
```

**記事の読み込み**:
```python
view_file(AbsolutePath="d:/projects/P010/knowledge/archive/20260120_a1cce2.md")
view_file(AbsolutePath="d:/projects/P010/knowledge/archive/20260121_f9e324.md")
view_file(AbsolutePath="d:/projects/P010/knowledge/archive/20260121_1153aa.md")
```

### 例2: MCPについて知りたい場合

**ユーザーリクエスト**: "MCPサーバーの実装方法を知りたい"

**実行**: ステップ1のコマンドで、`【現在のユーザーリクエスト】`を "MCPサーバーの実装方法を知りたい" に置き換えて実行。

**Claude CLIの出力例**:
```
SELECTED_ARTICLE_IDS:
- 20260121_3808a9    # 同じ社内ツールをOpenAI、Claude（MCP）、Geminiから呼ぶ最小設計
- 20260121_61630a    # Codex MCPを活用したAI Coding開発
- 20260120_c13016    # Claude Codeに別のAIエージェント（Codex等）を相談役として付けてみた
```


