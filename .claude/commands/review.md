# /review - コードレビュー

段階的にコードレビューを実行します。

## レビュー観点

### 1. セキュリティチェック

- [ ] 入力バリデーションは適切か
- [ ] 認証・認可の実装は正しいか
- [ ] シークレット情報がハードコードされていないか
- [ ] SQLインジェクション等の脆弱性はないか
- [ ] XSS対策は適切か

### 2. パフォーマンスチェック

- [ ] N+1問題がないか
- [ ] 不要なデータベースクエリがないか
- [ ] メモリリークの可能性はないか
- [ ] キャッシュ戦略は適切か

### 3. 保守性チェック

- [ ] 命名規約に従っているか
- [ ] DRY原則を守っているか
- [ ] 単一責任の原則を守っているか
- [ ] 適切なコメントがあるか（ただし過剰ではないか）

### 4. テストチェック

- [ ] テストカバレッジは80%以上か
- [ ] エッジケースをカバーしているか
- [ ] テストは独立して実行可能か
- [ ] テストの意図が明確か

## 評価基準

| 観点 | 配点 |
|------|------|
| セキュリティ | 25点 |
| パフォーマンス | 25点 |
| 保守性 | 25点 |
| テスト | 25点 |

**合計80点以上** → 承認
**80点未満** → 修正が必要

## レビュー完了後の処理

レビューが完了したら、スコアに応じて以下の処理を行ってください。

### 80点以上の場合（承認）

レビュー結果を自動的にIssueにコメントします。

#### Step 1: Issue番号の特定

ブランチ名からIssue番号を抽出します：

```bash
# ブランチ名を取得
BRANCH=$(git branch --show-current)

# Issue番号を抽出（例: feature/issue-18-xxx → 18）
ISSUE_NUM=$(echo "$BRANCH" | grep -oE 'issue-[0-9]+' | grep -oE '[0-9]+')

# 抽出結果を確認
echo "Issue番号: $ISSUE_NUM"
```

- Issue番号が特定できた場合 → Step 2 へ進む
- Issue番号が特定できない場合 → 「Issue番号を自動特定できませんでした。手動で `/issue-sync {番号}` を実行してください。」と案内してスキップ

#### Step 2: レビュー結果をIssueに投稿

以下の形式でIssueにコメントを投稿します：

```bash
gh issue comment $ISSUE_NUM --body "$(cat <<'EOF'
## レビュー完了報告 - {日時}

### レビュー結果
| 観点 | スコア |
|------|--------|
| セキュリティ | {X}/25 |
| パフォーマンス | {X}/25 |
| 保守性 | {X}/25 |
| テスト | {X}/25 |
| **合計** | **{X}/100** ✅ |

### 指摘事項
{指摘があれば記載、なければ「特になし」}

### 次のステップ
- PR作成準備完了
EOF
)"
```

投稿完了後、「レビュー結果をIssue #{番号} に投稿しました。」と報告してください。

### 80点未満の場合（要修正）

自動投稿は行いません。以下を案内してください：

- 修正が必要な箇所を明示
- 修正後に再度 `/review` を実行するよう案内
- 必要に応じて `/issue-sync` で進捗を同期することを提案
