# /tdd - TDDサイクル実行

TDD (Test-Driven Development) サイクルを実行します。

## 引数

- `--no-auto`: TDDサイクル完了後の自動処理（issue-sync, review）をスキップ

## 引数解析

TDDサイクル開始前に、`$ARGUMENTS` に `--no-auto` が含まれているか確認してください。
含まれている場合は、TDDサイクル完了後の自動処理をスキップします。

## 手順

### 1. RED - テストを書く

まず失敗するテストを書いてください：

- 実装したい機能の仕様を明確にする
- その仕様を検証するテストコードを作成
- テストが失敗することを確認

### 2. GREEN - 最小限の実装

テストを通す最小限のコードを書いてください：

- テストを通すことだけに集中
- 余計な機能は追加しない
- すべてのテストがパスすることを確認

### 3. REFACTOR - リファクタリング

コードを改善してください：

- 重複を排除
- 命名を改善
- 構造を整理
- テストが引き続きパスすることを確認

## 注意事項

- 各フェーズを必ず順番に実行すること
- REFACTORフェーズでは機能追加をしないこと
- テストカバレッジ80%以上を目標とすること

---

## TDDサイクル完了後の自動処理

TDDサイクル（RED → GREEN → REFACTOR）が完了したら、以下の自動処理を実行してください。

> **注意**: `--no-auto` オプションが指定されている場合は、このセクションをスキップしてください。

### Step 1: Issue番号の特定

ブランチ名からIssue番号を抽出します：

```bash
# ブランチ名を取得
BRANCH=$(git branch --show-current)

# Issue番号を抽出（例: feature/issue-18-xxx → 18）
ISSUE_NUM=$(echo "$BRANCH" | grep -oE 'issue-[0-9]+' | grep -oE '[0-9]+')

# 抽出結果を確認
echo "Issue番号: $ISSUE_NUM"
```

- Issue番号が特定できた場合 → Step 2 へ進む
- Issue番号が特定できない場合 → 「Issue番号を自動特定できませんでした。手動で `/issue-sync {番号}` を実行してください。」と案内して自動処理を終了

### Step 2: TDD完了報告をIssueに投稿

TDDサイクルの完了報告をIssueにコメントとして投稿します：

```bash
gh issue comment $ISSUE_NUM --body "$(cat <<'EOF'
## TDDサイクル完了報告 - {日時}

### 実装内容
- {実装した機能の概要}

### テスト結果
- テストケース数: {N}
- 成功: {N}/{N}
- カバレッジ: {X}%

### 変更ファイル
- {変更したファイル1}
- {変更したファイル2}

### 次のステップ
- コードレビューを実行中...
EOF
)"
```

### Step 3: コードレビューを実行

`/review` スキルを呼び出してコードレビューを実行してください。

> **重要**: `/review` は80点以上の場合、自動的にレビュー結果をIssueに投稿します（PR#25で実装済み）。そのため、レビュー後の `/issue-sync` は不要です。

### 自動処理フロー図

```
TDDサイクル完了
  ↓
Issue番号抽出（ブランチ名から）
  ↓
TDD完了報告をIssueに投稿
  ↓
/review 実行
  ↓ （80点以上の場合）
レビュー結果をIssueに自動投稿（/review の既存機能）
```

### 自動処理が失敗した場合

| 失敗箇所 | 対処方法 |
|---------|---------|
| Issue番号抽出失敗 | 手動で `/issue-sync {番号}` を実行 |
| Issue投稿失敗 | GitHub CLIの認証状態を確認し、手動で投稿 |
| レビュー80点未満 | 指摘事項を修正後、再度 `/tdd` を実行 |
